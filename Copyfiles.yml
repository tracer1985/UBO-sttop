---
- name: Copy all files 
  hosts: all
  become: yes
  remote_user: root
  vars:
    src_file: "/tmp/deployment/deployment_{{ lookup('pipe', 'date +%Y-%m-%d') }}/"
    destination_dir: "/opt/webadm/deployment/loyalty/staging/1.83.0/app/"
  tasks:
    - name: Ensure source files owned by webadm:webadm
      file:
        path: "{{ src_file }}"
        owner: webadm
        group: webadm
        recurse: yes

    - name: Copy all files from source to the destination directory (retain owner and group)
      synchronize:
        src: "{{ src_file }}"
        dest: "{{ destination_dir }}"
        owner: yes     # Explicitly retain owner
        group: yes     # Explicitly retain group
        recursive: yes
